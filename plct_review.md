---
marp: true
---
<!-- 中科院软件所 PLCT 实验室实习申请技术报告 -->
<!-- 2021-03-24 -->

# **RISC-V 与 Rust 语言与嵌入式**
华中科技大学计算机科学与技术学院  
车春池  
2021-03-24  
email: linuxgnulover@gmail.com  
github: https://github.com/SKTT1Ryze  


<!-- 注意：报告过程中需要多点技术细节 -->
---

## Outline
+ RISC-V 生态
+ Rust 语言
+ RISC-V 与嵌入式
+ Rust 语言与嵌入式
+ Rust 语言与 RISC-V 嵌入式

---

## RISC-V 生态
+ 开放的精简指令集架构，完全开源，设计简洁，模块化设计（举个例子），移植性强（SBI 标准）
+ 与 X86 架构对比：简化芯片开发，抛弃历史包裹，但目前在高性能处理核领域稍逊
+ 与 Arm 架构对比：开放，更先进的设计(举个例子)，但生态上需要进一步发展
+ 软硬协同设计（todo）

---

## RISC-V 生态
**RISC-V 在嵌入式领域大有可为**  
“对比 Arm, RISC-V 在成本，功耗，性能上目前都没有显著的优势，”，国内某知名芯片厂商产品经理，“但 RISC-V 的开放性会给嵌入式行业带来一个新的模式。”  
（出处：2020-12-26 全国操作系统大赛研讨会现场台下）

---

## RISC-V 与嵌入式
+ 精简的指令集设计对开发者友好（软件加硬件）(具体哪些方面：寄存器，中断，特权级)
+ 模块化的扩展指令集，开发者可以自由选择，根据需求定制自己的硬件（处理核，SoC）
+ 软硬协同设计（todo）
+ ISA 完全开源，技术自主可控
+ SBI 标准，便于移植有 S 态的操作系统

---

## Rust 语言
+ **21 世纪的语言新星**(ref: luojia)
+ Rust 的**安全哲学**（为了解决内存安全问题，对比 C/C++ 和 Go, java等）
+ 所有权，生命周期
+ 无垃圾回收，极小的运行时，同时兼顾安全与高效

---

## Rust 语言
+ 强大的类型系统，Trait 语法（可以考虑给个例子），支持泛型（常量泛型，如果时间足够的话可以给个例子），函数式编程
+ 友好的包管理（相比 C/C++ 是一个大优势）
+ 卫生宏，过程宏（内部展开，不影响上下文）
+ 成长的社区

---

## Rust 语言与嵌入式
**Rust 语言非常适合嵌入式软件开发**  

+ 极小并且可定制的运行时 -> 性能
+ 独特的内存管理 -> 安全（所有权模型 -> 外设抽象）
+ （包管理工具， 强大的宏） -> 生产效率
+ 丰富的编译目标（RISC-V, Arm, MIPS)
+ **异步支持**（最小的异步抽象库 `nb` 和内置的 async/await 语法）

---

## Rust 语言与嵌入式
**Rust 嵌入式生态**   
（todo：luojia 的图）
(ref: url)


---

## Rust 语言与嵌入式
（微架构运行时代码分析）
（外设访问库代码分析）

---

## Rust 语言与嵌入式
**embedded-hal 标准**  
+ Rust 嵌入式社区统一的标准
+ 这个库是对外设本身的抽象，提供一系列的 Trait,不涉及具体的实现（可以考虑列一下有哪些 Trait)
+ 实现由各个开发版（SoC）的实现库来完成（stm32f30x-hal， k210-hal）
+ 基于特定硬件的外设访问库来实现

---

## Rust 语言与 RISC-V 嵌入式
**以 RustSBI 为样本，对比竞品 OpenSBI 来分析**
+ 介绍 RISC-V SBI 标准，设计的优秀之处  
+ （介绍 RustSBI）(ref: luojia)
+ （RustSBI 支持 qemu 和 k210,并且功能比 OpenSBI 强大，RustSBI 代码一共 2000 多行，依赖于 k210-hal 和 k210-pac，突出 Rust 模块化设计的优点）
+ 对于 k210 的实现缺陷，通过 RustSBI 来弥补（突出 RISC-V 的优秀设计之一：SBI 标准）（代码分析）
+ RustSBI 模块化设计，对于某个特定的平台（硬件或模拟器），只要提供相应的 pac 库和 hal 库，即可很容易适配

---